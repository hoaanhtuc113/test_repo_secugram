<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SecuGram RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SecuGram Atom Feed"><title data-rh="true">One post tagged with &quot;mitre&quot; | SecuGram</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/blog/tags/mitre"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;mitre&quot; | SecuGram"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/blog/tags/mitre"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/mitre" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/blog/tags/mitre" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.528f818e.css">
<link rel="preload" href="/assets/js/runtime~main.12ac9ef4.js" as="script">
<link rel="preload" href="/assets/js/main.ea7091ab.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="SecuGram" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="SecuGram" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">SecuGram</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/first-blog-post">MITRE ATT&amp;CK Evaluation (Wizard Spider + Sandworm) - A Closer Look from Detection Engineer&#x27;s Perspective - Part 1</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;mitre&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/first-blog-post">MITRE ATT&amp;CK Evaluation (Wizard Spider + Sandworm) - A Closer Look from Detection Engineer&#x27;s Perspective - Part 1</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-18T00:00:00.000Z" itemprop="datePublished">April 18, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/hieuttmmo" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/46371125?v=4" alt="Hieu Tran"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/hieuttmmo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Hieu Tran</span></a></div><small class="avatar__subtitle" itemprop="description">Co-Founder, Security Consultant</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>Who won the MITRE ATT&amp;CK Evaluation?</strong></p><p>In Mar 2022, MITRE announced the result of their latest evaluations (Wizard Spider + Sandworm). Right after that, it&#x27;s not that hard to find vendor(s) claiming their detection cover 99%/100% of MITRE Evaluation. I believe MITRE Evaluation and MITRE ATT&amp;CK were never designed to be a compliance standard by any means, &quot;100% detection coverage&quot; is not the Holy Grail or the first indicator to look at from a practitioner&#x27;s perspective. Whenever thinking about aligning/implementing MITRE ATT&amp;CK, it requires a thorough process and answers to a lot of questions: </p><ul><li>What do we expect from EDR Alerts? Is it Tactic, Technique, or just General detection? </li><li>Do we really need 99%/100% telemetry from EDR? If yes, do we have enough resources/expertise/historical data to review loads and loads of alerts, filter out the noise, fine-tune the default rules, and many others?</li><li>...</li></ul><p>Josh Zelonis published an informative <a href="https://medium.com/the-recovering-analyst/the-mitre-att-ck-evaluation-needs-to-evolve-6bf2074138e4" target="_blank" rel="noopener noreferrer">blog</a> post sharing his thoughts on what buyers should be looking at and it is quite useful if your company is doing your assessment based on the MITRE Evaluation Results. </p><p>Coming back to the content related to the title, I was so curious about the missing piece in vendors’ results from a detection engineer’s perspective. In this series, I will try to figure out what is the common techniques that bypass most of the vendors&#x27; built-in detection capabilities. On top of that, another goal is to craft some Sigma rules and contribute to the Sigma community if possible.</p><p><strong>Pulling out the data</strong></p><p>Of course, the first thing needed to be done is to pull the result from the MITRE website. Josh Zelonis also published his script to do this job. Since it requires some changes to match my intention and I’m not a fan of (actually do not know how to use) pandas, I decide to build a new one. The main idea is to consolidate all the results into a single page, and after that use Pivot Table to manipulate and play with the data.
My tiny script can be found in my forked repo <a href="https://github.com/hieuttmmo/WizardSpider-Sandworm/blob/master/Consolidate-WizardSpider-Sandworm.py" target="_blank" rel="noopener noreferrer">here</a>.</p><p><strong>Playing and having fun with the data</strong></p><p>Insert a Pivot Table from the raw data, apply the filter for only undetected techniques, sorted by the number of vendors, and it makes me surprised a little bit inside.
<img loading="lazy" alt="Magic Happened!" src="/assets/images/first_stage-2b26183efbd45cf50b37b20439826844.png" title="San Juan Mountains" width="1226" height="1398" class="img_E7b_">
As we can see, the <code>System Information Discovery - T1082</code> is staying in the first place. Digging more into the actual sub-steps that have been run, we can see the 03 techniques staying under the radar by leveraging Windows API.
<img loading="lazy" alt="More Magic!" src="/assets/images/breakdown_by_criteria-7bc3c31ad41b19326144d5ceb3abdbe5.png" title="San Juan Mountains" width="1702" height="1440" class="img_E7b_">
For the sub-step <code>16.A.2 - rundll32.exe queries HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion for various subkeys</code>, among 8 vendors who can detect this activity, most of the vendors were able to detect it indirectly by monitoring access to registry, only Checkpoint and DeepInstinct trigger alerts related to suspicious Windows API Execution.</p><table><thead><tr><th>Vendor</th><th>Detection Type</th></tr></thead><tbody><tr><td>Checkpoint</td><td>Both</td></tr><tr><td>Cybereason</td><td>API Execution</td></tr><tr><td>Deepinstinct</td><td>Registry Access</td></tr><tr><td>McAfee</td><td>Registry Access</td></tr><tr><td>Microsoft</td><td>Registry Access</td></tr><tr><td>PaloAlto</td><td>Registry Access</td></tr><tr><td>SentinelOne</td><td>Registry Access</td></tr></tbody></table><p>Windows API Execution seems like “the dark of the moon” and poses a great room for improvement shortly. </p><p>In the second and third place, we can see most of the techniques were about rundll32.exe network connectivity. This is quite common and most EDR solutions can provide telemetry about the process that trying to make network connectivity. Event with Sysmon, we can capture this activity with community well-written configuration from @Florian Roth in this <a href="https://github.com/Neo23x0/sysmon-config" target="_blank" rel="noopener noreferrer">repo</a>.</p><p>We have a Sigma rule to detect this technique <a href="https://github.com/SigmaHQ/sigma/blob/cb60813067b40a88e74112d4eb33e61834c35363/rules/windows/network_connection/net_connection_win_rundll32_net_connections.yml" target="_blank" rel="noopener noreferrer">Rundll32 Internet Connection</a>. But it will not trigger any alert during the execution since the IP &#x27;192.168.<em>.</em>&#x27; already excluded.
<img loading="lazy" alt="More Magic!" src="/assets/images/sigma_rundll32_network_conn-86166b82e519dfe64b4747b1b629829f.png" title="San Juan Mountains" width="1614" height="1166" class="img_E7b_">
If you are trying to implement this rule, ensure that it will be tested carefully with the historical data (maybe 30, 60, or 90-day data). My suggestion is to start with only simple logic (process_name = rundll32.exe and event_id = 3), grouping by DestinationIP and then filtering out from that on a known-good connection.</p><p>This is the end of the first part of this series and the very first Secugram&#x27;s blog post. Hope you find your own answer to the question in the first section. In the second and maybe the third part of this series, I will go through some interesting sub-steps, try to execute them in my home lab, and write new Sigma rules whenever it is possible.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/secugram">secugram</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/security">security</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/detection-engineer">detection engineer</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/mitre">mitre</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about MITRE ATT&amp;CK Evaluation (Wizard Spider + Sandworm) - A Closer Look from Detection Engineer&#x27;s Perspective - Part 1" href="/blog/first-blog-post"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Secugram.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.12ac9ef4.js"></script>
<script src="/assets/js/main.ea7091ab.js"></script>
</body>
</html>